(this["webpackJsonpslack-music-bot-client"]=this["webpackJsonpslack-music-bot-client"]||[]).push([[0],{100:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),s=n(32),r=n.n(s),i=n(6),o=n(33),l=n.n(o),d=n(0),u={socketConnected:!1,socketId:"",isSyncMode:!1,isHost:!1,setIsSyncMode:function(){throw new Error("NOt implemented")}},b=Object(c.createContext)(u),j=function(e){var t=e.children,n=function(e){var t=Object(c.useRef)(),n=Object(c.useRef)(new l.a),a=Object(c.useState)(""),s=Object(i.a)(a,2),r=s[0],o=s[1],d=Object(c.useState)(!1),u=Object(i.a)(d,2),b=u[0],j=u[1],v=Object(c.useState)(!1),f=Object(i.a)(v,2),O=f[0],g=f[1],p=Object(c.useState)(!1),h=Object(i.a)(p,2),x=h[0],m=h[1];return Object(c.useEffect)((function(){var c=new WebSocket(e);t.current=c,c&&(c.onopen=function(){j(!0)},c.onclose=function(){o(""),j(!1)},c.onmessage=function(e){var t,c=JSON.parse(e.data),a=c.message,s=c.event_type;"welcome"===s&&o(a),"host"===s&&g("true"===a),null===(t=n.current)||void 0===t||t.emit(s,a),console.log("Received: "+e.data)})}),[e]),console.log({isHost:O}),Object(c.useEffect)((function(){return function(){t.current&&t.current.close(),n.current&&n.current.removeAllListeners()}}),[]),{socketRef:t,emitterRef:n,socketConnected:b,socketId:r,isHost:O,isSyncMode:x,setIsSyncMode:m}}(e.url||"");return Object(d.jsx)(b.Provider,{value:n,children:t})},v=function(){return Object(c.useContext)(b)},f=n(2),O=n(43),g=function(e){var t=e.className,n=void 0===t?"":t,c=e.children,a=e.id,s=Object(O.a)(e,["className","children","id"]);return Object(d.jsxs)("div",{className:"form-check form-switch",children:[Object(d.jsx)("input",Object(f.a)(Object(f.a)({type:"checkbox",className:"form-check-input ".concat(n)},s),{},{id:a})),Object(d.jsx)("label",{className:"form-check-label text-light",htmlFor:a,children:c})]})},p=function(){var e=v(),t=e.socketConnected,n=e.socketId,a=e.socketRef,s=e.isSyncMode,r=e.setIsSyncMode,i=e.isHost;return Object(c.useEffect)((function(){var e=null===a||void 0===a?void 0:a.current;t&&n&&e&&(s?e.send("/join sync"):e.send("/leave sync"))}),[s,a,t,n]),Object(d.jsx)("nav",{className:"navbar fixed-top navbar-expand-lg navbar-dark bg-dark",children:Object(d.jsxs)("div",{className:"container-fluid",children:[Object(d.jsx)("a",{className:"navbar-brand",href:"/",children:"Innovate Playlist"}),Object(d.jsx)("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarText","aria-controls":"navbarText","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(d.jsx)("span",{className:"navbar-toggler-icon"})}),Object(d.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarText",children:[Object(d.jsx)("ul",{className:"navbar-nav ms-auto",children:Object(d.jsx)("li",{className:"nav-item",children:s?i?Object(d.jsx)("span",{className:"nav-link badge bg-success text-dark","aria-current":"page",children:"Host"}):Object(d.jsx)("span",{className:"nav-link badge bg-light text-dark","aria-current":"page",children:"Guest"}):void 0})}),Object(d.jsx)("form",{className:"d-flex ms-auto",children:Object(d.jsx)(g,{onChange:function(e){var t=e.target.checked;r(t)},checked:s,children:"Sangai Sunam"})})]})]})})},h=n(9),x=n.n(h),m=n(13),k=n(7),y=n(40),N=n(34),S=n.n(N),w=n(35),C=n(36),E=n(14),_=n(37),R=n(41),P=n(42),I={baseUrl:"https://4c6836222db9.ngrok.io",webSocketUrl:"wss://4c6836222db9.ngrok.io/ws"},M=n(38),$=n.n(M),F=function(e){Object(_.a)(n,e);var t=Object(R.a)(n);function n(e,c,a,s){var r;return Object(w.a)(this,n),(r=t.call(this,c)).statusCode=void 0,r.details=void 0,r.axiosError=void 0,r.statusCode=e,r.details=a,r.axiosError=s,Object.setPrototypeOf(Object(E.a)(r),n.prototype),r}return Object(C.a)(n,[{key:"serializeErrors",value:function(){return[{message:this.message,status:this.statusCode,details:this.details}]}}]),n}(Object(P.a)(Error)),L=$.a.create({baseURL:I.baseUrl});L.interceptors.response.use((function(e){return e}),(function(e){if(e.response)throw new F(e.response.status,e.response.data.message,e.response.data,e.response);if(e.request)throw new F(500,"No Response",{},e.request);throw new F(500,e.message,{message:"Setting error"},{})}));var T=function(){var e=Object(m.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.request(t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(e){var t=e.title,n=e.className,c=void 0===n?"":n;return Object(d.jsx)("span",{className:"badge mt-1 me-2 ".concat(c),children:t})},H=function(e){var t=e.song,n=e.onClick,c=e.isCurrent,a=e.playing,s=e.progress,r=e.isNextSong,i=e.duration,o=e.className;return Object(d.jsxs)("li",{onClick:n,className:"list-group-item p-0 text-white px-5 py-2 mb-2 ".concat(o||""),style:{cursor:"pointer"},children:[Object(d.jsxs)("div",{className:" d-flex",children:[Object(d.jsx)("div",{className:"flex-shrink-0 d-flex",style:{width:"20%"},children:Object(d.jsx)("div",{className:"align-self-center",children:Object(d.jsx)("img",{src:t.thumbnail_url,className:"img-fluid",alt:t.title})})}),Object(d.jsxs)("div",{className:"flex-grow-1 py-2 px-3",children:[Object(d.jsx)("p",{className:"mb-1",children:t.title||t.url}),Object(d.jsx)("p",{className:"text-muted",children:t.description}),Object(d.jsxs)("div",{className:"d-flex",children:[c&&a&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(J,{className:"align-self-center bg-success",title:"Playing"}),Object(d.jsx)(J,{className:"align-self-center bg-light text-dark",title:"".concat(s," %")})]}),c&&!a&&Object(d.jsx)(J,{className:"align-self-center bg-danger",title:"Paused"}),r&&Object(d.jsx)(d.Fragment,{children:Object(d.jsx)(J,{className:"align-self-center bg-warning text-dark",title:"Up Next"})})]})]})]}),c&&Object(d.jsx)("div",{className:"progress bg-dark mt-2",style:{height:"4px"},children:Object(d.jsx)("div",{className:"progress-bar bg-danger",role:"progressbar",style:{width:"".concat(s,"%")},"aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":i})})]})},U=function(){return Object(d.jsx)("div",{className:"spinner-border text-light",role:"status",children:Object(d.jsx)("span",{className:"visually-hidden",children:"Loading..."})})},q=function(e){var t=e.children;return Object(d.jsx)("div",{className:"video-player",children:t})},D=n(39),z=n.n(D),B=function(){var e=v(),t=e.socketConnected,n=e.socketId,a=e.socketRef,s=e.emitterRef,r=e.isSyncMode,o=e.isHost,l=Object(c.useState)([]),u=Object(i.a)(l,2),b=u[0],j=u[1],O=Object(c.useState)(!1),g=Object(i.a)(O,2),p=g[0],h=g[1],N=Object(c.useState)(!1),w=Object(i.a)(N,2),C=w[0],E=w[1],_=Object(c.useRef)(null),R=Object(c.useState)({}),P=Object(i.a)(R,2),I=P[0],M=P[1],$=Object(c.useRef)({sendSeekMessage:function(){}}),F=Object(c.useState)({}),L=Object(i.a)(F,2),J=L[0],D=L[1],B=Object(c.useState)({}),G=Object(i.a)(B,2),V=G[0],W=G[1],A=Object(c.useState)({_id:{$oid:""},user:"",url:"",thumbnail_url:"",status:"pending",title:"",description:"",index:0}),K=Object(i.a)(A,2),Q=K[0],X=K[1],Y=Object(c.useCallback)((function(e){j([].concat(Object(y.a)(b),[e]))}),[b]),Z=!r||!!o,ee=Object(c.useCallback)((function(e,t){console.log({seekNum:e,isPlaying:t},"video");try{var n,c,a=null===_||void 0===_||null===(n=_.current)||void 0===n?void 0:n.getInternalPlayer();null===_||void 0===_||null===(c=_.current)||void 0===c||c.seekTo(e,"seconds"),a&&(console.log("video try update"),a.seekTo(e,!0),t?a.playVideo():a.pauseVideo(),h(t),M({}))}catch(s){console.log("video try update error",s)}}),[]),te=Object(c.useCallback)((function(e){var t=JSON.parse(e),n=t.video_id,c=t.video_index,a=t.seek,s=t.playing;console.log("video play pause handler");var r=Q._id.$oid,i=parseFloat(a),o=parseInt(c,10),l="true"===s,d=Q;r===n&&(console.log("current video"),X(Object(f.a)({},Q))),r!==n&&b.length>o&&(console.log("different video"),d=Object(f.a)(Object(f.a)({},b[o]),{},{index:o}),X(Object(f.a)({},d))),M(Object(k.a)({},n,{seek:i,playing:l}))}),[Q,b]),ne=Object(c.useCallback)((function(e){var t=JSON.parse(e),n=t.video_id,c=t.seek,a=V[n],s=parseFloat(c);a&&Math.abs((a.playedSeconds||0)-s)>.5&&M(Object(k.a)({},n,{seek:s,playing:!0}))}),[V]);Object(c.useEffect)((function(){var e,t=Q._id.$oid,n=I[t];if(!0===(null===(e=J[t])||void 0===e?void 0:e.ready)&&n){console.log("after video is ready from useEffect",n),ee(n.seek,n.playing||!1);var c=Q._id.$oid,a=V[c];W(Object(k.a)({},c,Object(f.a)(Object(f.a)({},a),{},{playedSeconds:n.seek})))}}),[J,Q,ee,I,V]);var ce=Object(c.useCallback)((function(){return null===a||void 0===a?void 0:a.current}),[a]),ae=Object(c.useCallback)((function(e){if(o&&r){var t,n,c=Q._id.$oid;null===(t=ce())||void 0===t||t.send("/pp ".concat(c," ").concat((null===(n=V[c])||void 0===n?void 0:n.playedSeconds)||0," ").concat(e," ").concat(Q.index||0))}}),[Q,r,o,ce,V]),se=Object(c.useCallback)((function(e){var t;o&&r&&(null===(t=ce())||void 0===t||t.send("/seek ".concat(Q._id.$oid," ").concat(e||0," ").concat(Q.index||0)))}),[o,r,Q,ce]);Object(c.useEffect)((function(){$.current={sendSeekMessage:z()(se,3e3,{maxWait:1500,leading:!1,trailing:!0})}}),[se]);var re=Object(c.useCallback)((function(){ae(p)}),[ae,p]);Object(c.useEffect)((function(){var e=null===a||void 0===a?void 0:a.current,c=null===s||void 0===s?void 0:s.current;return c&&n&&t&&e&&o&&r&&c.on("syncRoomJoined",re),function(){null===c||void 0===c||c.removeListener("syncRoomJoined",re)}}),[a,s,t,n,re,p,o,r]),Object(c.useEffect)((function(){var e=null===a||void 0===a?void 0:a.current,c=null===s||void 0===s?void 0:s.current;return e&&t&&n&&c&&(c.on("playPause",te),c.on("seek",ne)),function(){null===c||void 0===c||c.removeListener("playPause",te),null===c||void 0===c||c.removeListener("seek",ne)}}),[a,s,n,t,te,ne]),Object(c.useEffect)((function(){var e=null===a||void 0===a?void 0:a.current,c=null===s||void 0===s?void 0:s.current,r=function(e){var t=JSON.parse(e);Y(t)};return t&&e&&n&&c&&c.on("newSong",r),function(){null===c||void 0===c||c.removeListener("newSong",r)}}),[n,t,a,s,Y]),Object(c.useEffect)((function(){(function(){var e=Object(m.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,E(!0),e.next=4,T({method:"GET",url:"/playlist"});case 4:t=e.sent,j(t);case 6:return e.prev=6,E(!1),e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[0,,6,9]])})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(c.useEffect)((function(){!b.length||p||Q.url||X(Object(f.a)(Object(f.a)(Object(f.a)({},Q),b[0]),{},{index:0}))}),[b,p,Q]);var ie=V[Q._id.$oid]||{playedSeconds:0,duration:0},oe=ie.playedSeconds,le=ie.duration,de=oe&&le?Math.round(oe/le*100):0;return C?Object(d.jsx)("div",{className:"max-height bg-dark d-flex align-items-center justify-content-center w-full",children:Object(d.jsx)(U,{})}):Object(d.jsxs)("div",{className:"overflow-hidden d-flex bg-dark",children:[Object(d.jsxs)("div",{className:"flex-grow-1 col max-height",children:[!Z&&Object(d.jsx)("div",{style:{width:"100%",height:"100%",zIndex:1,position:"absolute"}}),Object(d.jsx)(S.a,{ref:_,url:Q.url,playing:p,onReady:function(){console.log("video ready callback"),D(Object(k.a)({},Q._id.$oid,{ready:!0}))},onStart:function(){ae(!0),h(!0)},onPlay:function(){ae(!0),h(!0)},onPause:function(){ae(!1),h(!1)},pip:!0,onSeek:function(e){Z&&se(e)},onProgress:function(e){var t=e.playedSeconds,n=Q._id.$oid,c=V[n];W(Object(k.a)({},n,Object(f.a)(Object(f.a)({},c),{},{playedSeconds:t}))),$.current.sendSeekMessage(t)},onDuration:function(e){var t=Q._id.$oid,n=V[t];W(Object(k.a)({},t,Object(f.a)(Object(f.a)({},n),{},{duration:e})))},onEnded:function(){if(b.length){var e=Q.index+1;e===b.length?X(Object(f.a)(Object(f.a)({},b[0]),{},{index:0})):X(Object(f.a)(Object(f.a)({},b[e]),{},{index:e}))}},width:"100%",wrapper:q})]}),Object(d.jsx)("div",{className:"flex-shrink-0 col-sm-4 overflow-auto max-height",children:Object(d.jsx)("ul",{className:"list-group list-group-flush",children:b.map((function(e,t){var n,c,a,s=(null===(n=Q._id)||void 0===n?void 0:n.$oid)===(null===(c=e._id)||void 0===c?void 0:c.$oid),r=Q.index+1,i=r===b.length?0:r;return Object(d.jsx)(H,{className:"".concat(s?"bg-black":"bg-dark"),onClick:function(n){n.preventDefault(),!s&&Z&&(X(Object(f.a)(Object(f.a)({},e),{},{index:t})),h(!0))},song:e,isCurrent:s,playing:p,isNextSong:i===t,duration:le||0,progress:de},null===(a=e._id)||void 0===a?void 0:a.$oid)}))})})]})};var G=function(){return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(p,{}),Object(d.jsx)(B,{})]})},V=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,101)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),s(e),r(e)}))};n(99);r.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(j,{url:I.webSocketUrl,children:Object(d.jsx)(G,{})})}),document.getElementById("root")),V()},99:function(e,t,n){}},[[100,1,2]]]);
//# sourceMappingURL=main.94587b3d.chunk.js.map