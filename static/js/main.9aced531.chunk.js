(this["webpackJsonpslack-music-bot-client"]=this["webpackJsonpslack-music-bot-client"]||[]).push([[0],{294:function(e,t,n){},303:function(e,t){},348:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),s=n(26),r=n.n(s),i=n(7),o=n(9),l={baseUrl:"https://slack-music-bot-rs.herokuapp.com",webSocketUrl:"wss://slack-music-bot-rs.herokuapp.com/ws",appName:"Innovate Playlist"},d=n(158),u=n.n(d),b=n(1),j={latency:0,tolerance:.9},v={socketConnected:!1,socketId:"",isSyncMode:!1,isHost:!1,setIsSyncMode:function(){throw new Error("NOt implemented")},latencyAndTolerance:j,setLatencyAndTolerance:function(){throw new Error("NOt implemented")}},O=Object(a.createContext)(v),f=function(e){var t=e.children,n=function(e){var t=Object(a.useRef)(),n=Object(a.useRef)(new u.a),c=Object(a.useState)(""),s=Object(o.a)(c,2),r=s[0],i=s[1],l=Object(a.useState)(!1),d=Object(o.a)(l,2),b=d[0],v=d[1],O=Object(a.useState)(j),f=Object(o.a)(O,2),g=f[0],p=f[1],x=Object(a.useState)(!1),m=Object(o.a)(x,2),h=m[0],y=m[1],k=Object(a.useState)(!1),N=Object(o.a)(k,2),S=N[0],w=N[1];return Object(a.useEffect)((function(){var a=new WebSocket(e);t.current=a,a&&(a.onopen=function(){v(!0)},a.onclose=function(){i(""),v(!1)},a.onmessage=function(e){var t,a=JSON.parse(e.data),c=a.message,s=a.event_type;"welcome"===s&&i(c),"host"===s&&y("true"===c),null===(t=n.current)||void 0===t||t.emit(s,c),console.log("Received: "+e.data)})}),[e]),Object(a.useEffect)((function(){return function(){t.current&&t.current.close(),n.current&&n.current.removeAllListeners()}}),[]),{socketRef:t,emitterRef:n,socketConnected:b,socketId:r,isHost:h,isSyncMode:S,latencyAndTolerance:g,setLatencyAndTolerance:p,setIsSyncMode:w}}(e.url||"");return Object(b.jsx)(O.Provider,{value:n,children:t})},g=function(){return Object(a.useContext)(O)},p=n(170),x=function(e){var t=e.className,n=void 0===t?"":t,a=e.children,c=e.id,s=Object(p.a)(e,["className","children","id"]);return Object(b.jsxs)("div",{className:"form-check form-switch ".concat(n),children:[Object(b.jsx)("input",Object(i.a)(Object(i.a)({type:"checkbox",className:"form-check-input"},s),{},{id:c})),Object(b.jsx)("label",{className:"form-check-label text-light",htmlFor:c,children:a})]})},m=function(){var e=g(),t=e.socketConnected,n=e.socketId,c=e.socketRef,s=e.isSyncMode,r=e.setIsSyncMode,d=e.isHost,u=e.latencyAndTolerance,j=e.setLatencyAndTolerance,v=Object(a.useState)(!1),O=Object(o.a)(v,2),f=O[0],p=O[1];return Object(a.useEffect)((function(){var e=null===c||void 0===c?void 0:c.current;t&&n&&e&&(s?e.send("/join sync"):e.send("/leave sync"))}),[s,c,t,n]),Object(b.jsx)("nav",{className:"navbar fixed-top navbar-expand-lg navbar-dark bg-dark",children:Object(b.jsxs)("div",{className:"container-fluid",children:[Object(b.jsx)("a",{className:"navbar-brand",href:"/",children:l.appName}),Object(b.jsx)("button",{className:"navbar-toggler",type:"button",onClick:function(e){e.preventDefault(),p(!f)},"aria-expanded":f,"data-bs-toggle":"collapse","data-bs-target":"#navbarText","aria-controls":"navbarText","aria-label":"Toggle navigation",children:Object(b.jsx)("span",{className:"navbar-toggler-icon"})}),Object(b.jsxs)("div",{className:"collapse navbar-collapse ".concat(f?"show":""),id:"navbarText",children:[Object(b.jsx)("ul",{className:"navbar-nav py-2 py-md-0",children:Object(b.jsx)("li",{className:"nav-item",children:s?d?Object(b.jsx)("span",{className:"nav-link badge bg-success text-dark","aria-current":"page",children:"Host"}):Object(b.jsx)("span",{className:"nav-link badge bg-warning text-dark","aria-current":"page",children:"Guest"}):void 0})}),Object(b.jsxs)("form",{className:"d-flex ms-auto",children:[s&&!d&&Object(b.jsx)(b.Fragment,{children:Object(b.jsxs)("div",{className:"input-group me-1",children:[Object(b.jsxs)("span",{className:"input-group-text bg-dark text-light border-0",children:["Latency:"," "]}),Object(b.jsx)("span",{className:"input-group-text bg-dark text-light border-0",children:u.latency.toFixed(2)}),Object(b.jsxs)("span",{className:"input-group-text bg-dark text-light border-0",children:["Tolerance:"," "]}),Object(b.jsx)("input",{type:"number",min:"0",max:"5",style:{width:"75px"},className:"form-control bg-dark text-light border-0",step:"0.1",value:u.tolerance,onChange:function(e){var t=e.target.value;j(Object(i.a)(Object(i.a)({},u),{},{tolerance:parseFloat(t||"0")}))},"aria-label":"Dollar amount (with dot and two decimal places)"})]})}),Object(b.jsx)(x,{className:"flex-shrink-0 align-self-center",onChange:function(e){var t=e.target.checked;r(t)},checked:s,children:"Sangai Sunam"})]})]})]})})},h=n(42),y=n.n(h),k=n(58),N=n(27),S=n(167),w=n(159),D=n.n(w),C=n(160),_=n(161),M=n(59),I=n(162),E=n(168),T=n(169),R=n(163),F=n.n(R),L=function(e){Object(I.a)(n,e);var t=Object(E.a)(n);function n(e,a,c,s){var r;return Object(C.a)(this,n),(r=t.call(this,a)).statusCode=void 0,r.details=void 0,r.axiosError=void 0,r.statusCode=e,r.details=c,r.axiosError=s,Object.setPrototypeOf(Object(M.a)(r),n.prototype),r}return Object(_.a)(n,[{key:"toJSON",value:function(){return{message:this.message,status:this.statusCode,details:this.details}}}]),n}(Object(T.a)(Error)),P=F.a.create({baseURL:l.baseUrl});P.interceptors.response.use((function(e){return e}),(function(e){if(e.response)throw new L(e.response.status,e.response.data.message,e.response.data,e.response);if(e.request)throw new L(500,"No response from server",{},e.request);throw new L(500,e.message,{message:"Setting error"},{})}));var $=function(){var e=Object(k.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.request(t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(e){var t=e.title,n=e.className,a=void 0===n?"":n;return Object(b.jsx)("span",{className:"badge mt-1 me-2 ".concat(a),children:t})},A=function(e){var t=e.song,n=e.onClick,a=e.isCurrent,c=e.playing,s=e.progress,r=e.isNextSong,i=e.duration,o=e.className;return Object(b.jsxs)("li",{onClick:n,className:"list-group-item p-0 text-white px-5 py-2 mb-2 ".concat(o||""),style:{cursor:"pointer"},children:[Object(b.jsxs)("div",{className:" d-flex",children:[Object(b.jsx)("div",{className:"flex-shrink-0 d-flex",style:{width:"20%"},children:Object(b.jsx)("div",{className:"align-self-center",children:Object(b.jsx)("img",{src:t.thumbnail_url,className:"img-fluid",alt:t.title})})}),Object(b.jsxs)("div",{className:"flex-grow-1 py-2 px-3",children:[Object(b.jsx)("p",{className:"mb-1",children:t.title||t.url}),Object(b.jsx)("p",{className:"text-muted",children:t.description}),Object(b.jsxs)("div",{className:"d-flex",children:[a&&c&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(J,{className:"align-self-center bg-success",title:"Playing"}),Object(b.jsx)(J,{className:"align-self-center bg-light text-dark",title:"".concat(s," %")})]}),a&&!c&&Object(b.jsx)(J,{className:"align-self-center bg-danger",title:"Paused"}),r&&Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(J,{className:"align-self-center bg-warning text-dark",title:"Up Next"})})]})]})]}),a&&Object(b.jsx)("div",{className:"progress bg-dark mt-2",style:{height:"4px"},children:Object(b.jsx)("div",{className:"progress-bar bg-danger",role:"progressbar",style:{width:"".concat(s,"%")},"aria-valuenow":s,"aria-valuemin":0,"aria-valuemax":i})})]})},U=function(){return Object(b.jsx)("div",{className:"spinner-border text-light",role:"status",children:Object(b.jsx)("span",{className:"visually-hidden",children:"Loading..."})})},H=function(e){var t=e.children;return Object(b.jsx)("div",{className:"video-player",children:t})},q=n(75),B=n.n(q),G=n(164),V=n(4),W=n.n(V),z=function(e){var t=e.startDate,n=e.endDate,c=e.startDateId,s=e.endDateId,r=e.onDatesChange,i=Object(a.useState)(null),l=Object(o.a)(i,2),d=l[0],u=l[1];return Object(b.jsx)(G.DateRangePicker,{startDate:t,displayFormat:"dddd, MMM D",isDayBlocked:function(e){return e.isAfter(W()())},startDateId:c,isOutsideRange:function(){return!1},endDate:n,endDateId:s,onDatesChange:r,focusedInput:d,onFocusChange:u})},K=function(){var e=g(),t=e.socketConnected,n=e.socketId,c=e.socketRef,s=e.emitterRef,r=e.isSyncMode,l=e.isHost,d=e.latencyAndTolerance,u=e.setLatencyAndTolerance,j=Object(a.useState)([]),v=Object(o.a)(j,2),O=v[0],f=v[1],p=Object(a.useState)(!1),x=Object(o.a)(p,2),m=x[0],h=x[1],w=Object(a.useState)(),C=Object(o.a)(w,2),_=C[0],M=C[1],I=Object(a.useState)(!1),E=Object(o.a)(I,2),T=E[0],R=E[1],F=Object(a.useState)({startDate:W()().startOf("day"),endDate:W()().endOf("day")}),L=Object(o.a)(F,2),P=L[0],J=L[1],q=Object(a.useRef)(null),G=Object(a.useState)({}),V=Object(o.a)(G,2),K=V[0],Q=V[1],X=Object(a.useRef)({sendSeekMessage:function(){}}),Y=Object(a.useState)({}),Z=Object(o.a)(Y,2),ee=Z[0],te=Z[1],ne=Object(a.useState)({}),ae=Object(o.a)(ne,2),ce=ae[0],se=ae[1],re=Object(a.useState)({_id:{$oid:""},user:"",url:"",thumbnail_url:"",status:"pending",title:"",description:"",index:0}),ie=Object(o.a)(re,2),oe=ie[0],le=ie[1],de=Object(a.useCallback)((function(e){f([].concat(Object(S.a)(O),[e]))}),[O]),ue=!r||!!l,be=Object(a.useCallback)((function(e,t){console.log({seekNum:e,isPlaying:t},"video");try{var n,a,c=null===q||void 0===q||null===(n=q.current)||void 0===n?void 0:n.getInternalPlayer();null===q||void 0===q||null===(a=q.current)||void 0===a||a.seekTo(e,"seconds"),c&&(console.log("video try update"),c.seekTo(e,!0),t?c.playVideo():c.pauseVideo(),h(t),Q({}))}catch(s){console.log("video try update error",s)}}),[]),je=Object(a.useCallback)((function(e){var t=JSON.parse(e),n=t.video_id,a=t.video_index,c=t.seek,s=t.playing;console.log("video play pause handler");var r=oe._id.$oid,o=parseFloat(c),l=parseInt(a,10),d="true"===s,u=oe;r===n&&(console.log("current video"),le(Object(i.a)({},oe))),r!==n&&O.length>l&&(console.log("different video"),u=Object(i.a)(Object(i.a)({},O[l]),{},{index:l}),le(Object(i.a)({},u))),Q(Object(N.a)({},n,{seek:o,playing:d}))}),[oe,O]),ve=Object(a.useCallback)((function(e){var t=JSON.parse(e),n=t.video_id,a=t.seek,c=t.video_index,s=ce[n];if(!s)return je(JSON.stringify({video_id:n,video_index:c,seek:a,playing:!0}));var r=parseFloat(a),o=Math.abs(((null===s||void 0===s?void 0:s.playedSeconds)||0)-r),l=d.tolerance;console.log({difference:o,tolerance:l}),u(Object(i.a)(Object(i.a)({},d),{},{latency:o})),s&&o>l&&Q(Object(N.a)({},n,{seek:r,playing:!0}))}),[ce,d,u,je]);Object(a.useEffect)((function(){var e,t=oe._id.$oid,n=K[t];if(!0===(null===(e=ee[t])||void 0===e?void 0:e.ready)&&n){console.log("after video is ready from useEffect",n),be(n.seek,n.playing||!1);var a=oe._id.$oid,c=ce[a];se(Object(N.a)({},a,Object(i.a)(Object(i.a)({},c),{},{playedSeconds:n.seek})))}}),[ee,oe,O,be,K,ce]);var Oe=Object(a.useCallback)((function(){return null===c||void 0===c?void 0:c.current}),[c]),fe=Object(a.useCallback)((function(e){if(l&&r){var t,n,a=oe._id.$oid;null===(t=Oe())||void 0===t||t.send("/pp ".concat(a," ").concat((null===(n=ce[a])||void 0===n?void 0:n.playedSeconds)||0," ").concat(e," ").concat(oe.index||0))}}),[oe,r,l,Oe,ce]),ge=Object(a.useCallback)((function(e){var t;l&&r&&(null===(t=Oe())||void 0===t||t.send("/seek ".concat(oe._id.$oid," ").concat(e||0," ").concat(oe.index||0)))}),[l,r,oe,Oe]);Object(a.useEffect)((function(){X.current={sendSeekMessage:B()(ge,3e3,{maxWait:1500,leading:!1,trailing:!0})}}),[ge]);var pe=Object(a.useCallback)((function(){if(l&&r){var e,t=P.startDate,n=P.endDate;console.log("notify date change"),null===(e=Oe())||void 0===e||e.send("/date ".concat(null===t||void 0===t?void 0:t.unix()," ").concat(null===n||void 0===n?void 0:n.unix()))}}),[P,l,r,Oe]),xe=Object(a.useCallback)((function(){fe(m),pe()}),[fe,m,pe]);Object(a.useEffect)((function(){var e=null===c||void 0===c?void 0:c.current,a=null===s||void 0===s?void 0:s.current;return a&&n&&t&&e&&l&&r&&a.on("syncRoomJoined",xe),function(){null===a||void 0===a||a.removeListener("syncRoomJoined",xe)}}),[c,s,t,n,xe,m,l,r]);var me=Object(a.useCallback)((function(e){var t=JSON.parse(e),n=t.start_date,a=t.end_date;J({startDate:W.a.unix(n),endDate:W.a.unix(a)})}),[]);Object(a.useEffect)((function(){var e=null===c||void 0===c?void 0:c.current,a=null===s||void 0===s?void 0:s.current;return e&&t&&n&&a&&(a.on("playPause",je),a.on("seek",ve),a.on("date",me)),function(){null===a||void 0===a||a.removeListener("playPause",je),null===a||void 0===a||a.removeListener("seek",ve),null===a||void 0===a||a.removeListener("date",me)}}),[c,s,n,t,je,ve,me]),Object(a.useEffect)((function(){var e=null===c||void 0===c?void 0:c.current,a=null===s||void 0===s?void 0:s.current,r=function(e){var t=JSON.parse(e);de(t)};return t&&e&&n&&a&&a.on("newSong",r),function(){null===a||void 0===a||a.removeListener("newSong",r)}}),[n,t,c,s,de]);var he=Object(a.useCallback)(Object(k.a)(y.a.mark((function e(){var t,n,a;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=P.startDate,n=P.endDate,e.prev=1,R(!0),e.next=5,c={startDate:null===t||void 0===t?void 0:t.unix(),endDate:null===n||void 0===n?void 0:n.unix()},$({method:"GET",url:"/playlist",params:c});case 5:a=e.sent,f(a),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),M(e.t0);case 12:return e.prev=12,R(!1),e.finish(12);case 15:case"end":return e.stop()}var c}),e,null,[[1,9,12,15]])}))),[P]);Object(a.useEffect)((function(){he(),pe()}),[he,pe]),Object(a.useEffect)((function(){!O.length||m||oe.url||le(Object(i.a)(Object(i.a)(Object(i.a)({},oe),O[0]),{},{index:0}))}),[O,m,oe]);var ye=ce[oe._id.$oid]||{playedSeconds:0,duration:0},ke=ye.playedSeconds,Ne=ye.duration,Se=ke&&Ne?Math.round(ke/Ne*100):0,we=P.startDate,De=P.endDate;return _?Object(b.jsx)("div",{className:"max-height bg-dark d-flex align-items-center text-light justify-content-center w-full",children:_.message||"Oops! Something went wrong"}):T&&!O.length?Object(b.jsx)("div",{className:"max-height bg-dark d-flex align-items-center justify-content-center w-full",children:Object(b.jsx)(U,{})}):Object(b.jsxs)("div",{className:"overflow-hidden d-flex bg-dark",children:[Object(b.jsxs)("div",{className:"flex-grow-1 col max-height",children:[!ue&&Object(b.jsx)("div",{style:{width:"100%",height:"100%",zIndex:1,position:"absolute"}}),Object(b.jsx)(D.a,{ref:q,url:oe.url,playing:m,onReady:function(){console.log("video ready callback"),te(Object(N.a)({},oe._id.$oid,{ready:!0}))},onStart:function(){fe(!0),h(!0)},onPlay:function(){fe(!0),h(!0)},onPause:function(){fe(!1),h(!1)},pip:!0,onSeek:function(e){ue&&ge(e)},onProgress:function(e){var t=e.playedSeconds,n=oe._id.$oid,a=ce[n];se(Object(N.a)({},n,Object(i.a)(Object(i.a)({},a),{},{playedSeconds:t}))),X.current.sendSeekMessage(t)},onDuration:function(e){var t=oe._id.$oid,n=ce[t];se(Object(N.a)({},t,Object(i.a)(Object(i.a)({},n),{},{duration:e})))},onEnded:function(){if(O.length){var e=oe.index+1;e===O.length?le(Object(i.a)(Object(i.a)({},O[0]),{},{index:0})):le(Object(i.a)(Object(i.a)({},O[e]),{},{index:e}))}},width:"100%",wrapper:H})]}),Object(b.jsxs)("div",{className:"flex-shrink-0 col-sm-4 max-height",children:[ue?Object(b.jsx)(z,{startDate:we,startDateId:"startDate",endDate:De,endDateId:"endDate",onDatesChange:function(e){var t=e.startDate,n=e.endDate;J({startDate:(null===t||void 0===t?void 0:t.startOf("day"))||null,endDate:(null===n||void 0===n?void 0:n.endOf("day"))||null})}}):Object(b.jsxs)("div",{className:"text-light p-4 text-center",children:[W()(we).format("dddd, MMM D"),Object(b.jsx)("span",{className:"px-4",children:"to"}),W()(De).format("dddd, MMM D")]}),T&&Object(b.jsx)("div",{className:"d-flex align-items-center justify-content-center p-2",style:{width:"100%"},children:Object(b.jsx)(U,{})}),Object(b.jsx)("ul",{className:"list-group list-group-flush overflow-auto max-height-no-margin pb-5",children:O.map((function(e,t){var n,a,c,s=(null===(n=oe._id)||void 0===n?void 0:n.$oid)===(null===(a=e._id)||void 0===a?void 0:a.$oid),r=oe.index+1,o=r===O.length?0:r;return Object(b.jsx)(A,{className:"".concat(s?"bg-black":"bg-dark"),onClick:function(n){n.preventDefault(),!s&&ue&&(le(Object(i.a)(Object(i.a)({},e),{},{index:t})),h(!0))},song:e,isCurrent:s,playing:m,isNextSong:o===t,duration:Ne||0,progress:Se},null===(c=e._id)||void 0===c?void 0:c.$oid)}))})]})]})},Q=n(165);var X=function(){return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(Q.a,{children:Object(b.jsx)("title",{children:l.appName})}),Object(b.jsx)(m,{}),Object(b.jsx)(K,{})]})},Y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,349)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};n(293),n(294),n(295);r.a.render(Object(b.jsx)(c.a.StrictMode,{children:Object(b.jsx)(f,{url:l.webSocketUrl,children:Object(b.jsx)(X,{})})}),document.getElementById("root")),Y()}},[[348,1,2]]]);
//# sourceMappingURL=main.9aced531.chunk.js.map